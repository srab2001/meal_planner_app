// This file is part of the meal_planner monorepo
// Fitness module - separate Prisma schema
// Database: Dedicated Neon PostgreSQL

generator client {
  provider = "prisma-client-js"
  output   = "./generated/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// User fitness profiles - one per user
model fitness_profiles {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id         String   @unique @db.Uuid
  height_cm       Int?
  weight_kg       Decimal? @db.Decimal(6, 2)
  age             Int?
  gender          String?
  activity_level  String?
  created_at      DateTime @default(now()) @db.Timestamptz(6)
  updated_at      DateTime @default(now()) @db.Timestamptz(6)

  @@index([user_id], map: "idx_fitness_profiles_user_id")
}

/// Fitness goals - weight loss, muscle gain, endurance
model fitness_goals {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id      String    @db.Uuid
  goal_type    String    // "weight_loss", "muscle_gain", "endurance"
  target_value Decimal?  @db.Decimal(8, 2)
  unit         String?   // "lbs", "kg", "minutes", "reps"
  start_date   DateTime? @db.Date
  target_date  DateTime? @db.Date
  status       String    @default("active") // "active", "completed", "abandoned"
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  updated_at   DateTime  @default(now()) @db.Timestamptz(6)

  @@index([user_id], map: "idx_fitness_goals_user_id")
  @@index([status], map: "idx_fitness_goals_status")
}

/// Fitness workouts - individual workout sessions
model fitness_workouts {
  id                    String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id               String   @db.Uuid
  workout_date          DateTime @db.Date
  workout_type          String   // "strength", "cardio", "hiit"
  duration_minutes      Int?
  notes                 String?
  created_at            DateTime @default(now()) @db.Timestamptz(6)
  workout_exercises     fitness_workout_exercises[]

  @@index([user_id], map: "idx_fitness_workouts_user_id")
  @@index([workout_date], map: "idx_fitness_workouts_date")
}

/// Exercises within a workout
model fitness_workout_exercises {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workout_id      String   @db.Uuid
  exercise_name   String
  exercise_order  Int?
  created_at      DateTime @default(now()) @db.Timestamptz(6)
  workout         fitness_workouts @relation(fields: [workout_id], references: [id], onDelete: Cascade)
  sets            fitness_workout_sets[]

  @@index([workout_id], map: "idx_fitness_workout_exercises_workout_id")
}

/// Sets for each exercise
model fitness_workout_sets {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  exercise_id     String   @db.Uuid
  set_number      Int
  reps            Int?
  weight          Decimal? @db.Decimal(8, 2)
  duration_seconds Int?
  created_at      DateTime @default(now()) @db.Timestamptz(6)
  exercise        fitness_workout_exercises @relation(fields: [exercise_id], references: [id], onDelete: Cascade)

  @@index([exercise_id], map: "idx_fitness_workout_sets_exercise_id")
}

/// Admin-managed interview questions for AI Coach
model admin_interview_questions {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  question    String   @db.Text // The actual question text
  type        String   // "text", "multiple_choice", "range", "yes_no"
  options     String?  @db.Text // JSON array for multiple_choice type
  order       Int      @default(0) // Display order
  active      Boolean  @default(true) // Whether to show this question
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  updated_at  DateTime @default(now()) @db.Timestamptz(6)

  @@index([active], map: "idx_admin_interview_questions_active")
  @@index([order], map: "idx_admin_interview_questions_order")
}
