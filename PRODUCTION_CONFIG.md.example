# Production Configuration Guide

**üìã How to use this file:**
1. Copy this file: `cp PRODUCTION_CONFIG.md.example PRODUCTION_CONFIG.md`
2. Edit `PRODUCTION_CONFIG.md` with your actual credentials
3. The actual `PRODUCTION_CONFIG.md` is git-ignored and won't be committed

This template contains the environment variable configuration structure for your production deployment.

## Current Production Setup

- **Frontend (Vercel)**: `https://your-frontend.vercel.app`
- **Backend (Render)**: `https://your-backend.onrender.com`

---

## Render (Backend) Environment Variables

Go to your Render dashboard ‚Üí Your service ‚Üí Environment

**‚ö†Ô∏è IMPORTANT**: Variable names are case-sensitive. Use exact capitalization shown below.

```bash
# Server Configuration
PORT=5000
NODE_ENV=production

# Google OAuth
GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-client-secret
GOOGLE_CALLBACK_URL=https://your-backend.onrender.com/auth/google/callback
FRONTEND_BASE=https://your-frontend.vercel.app

# Session & API
SESSION_SECRET=your-session-secret-here
OPENAI_API_KEY=sk-proj-your-openai-key-here

# Optional: Price Scraping
PRICE_CACHE_TTL=86400000
ENABLE_PRICE_SCRAPING=true
```

### Critical Checks for Render:
- [ ] `NODE_ENV` is set to `production` (not `development`)
- [ ] `GOOGLE_CALLBACK_URL` points to your Render URL
- [ ] `FRONTEND_BASE` points to your Vercel URL (no trailing slash)
- [ ] All variable names are UPPERCASE (especially `GOOGLE_CLIENT_ID`)

---

## Vercel (Frontend) Environment Variables

Go to Vercel ‚Üí Your Project ‚Üí Settings ‚Üí Environment Variables

**Add this single variable:**

```bash
REACT_APP_API_URL=https://meal-planner-app-mve2.onrender.com
```

### How to add in Vercel:
1. Go to https://vercel.com/dashboard
2. Select your project: `meal-planner-app`
3. Click **Settings** ‚Üí **Environment Variables**
4. Click **Add**
5. Enter:
   - **Key**: `REACT_APP_API_URL`
   - **Value**: `https://meal-planner-app-mve2.onrender.com`
   - **Environment**: Check `Production` (and optionally `Preview` and `Development`)
6. Click **Save**
7. **Redeploy** your application for changes to take effect

### Critical Checks for Vercel:
- [ ] `REACT_APP_API_URL` points to your Render backend URL
- [ ] No trailing slash on the URL
- [ ] Applied to Production environment
- [ ] Redeployed after adding the variable

---

## Google Cloud Console Configuration

Your OAuth credentials are already configured correctly with these redirect URIs:

‚úÖ **Authorized JavaScript origins:**
- `https://meal-planner-app-chi.vercel.app`
- `https://meal-planner-app-mve2.onrender.com`

‚úÖ **Authorized redirect URIs:**
- `http://localhost:5000/auth/google/callback` (for local development)
- `https://meal-planner-app-mve2.onrender.com/auth/google/callback` (for production)

**No changes needed** in Google Cloud Console - your configuration is correct!

---

## Testing the Fix

After setting the environment variables:

### 1. Verify Render Backend

Visit: `https://your-backend.onrender.com/health`

Expected response:
```json
{"status":"ok"}
```

### 2. Check Render Logs

In Render dashboard, check logs for:
```
GOOGLE_CLIENT_ID present: true
GOOGLE_CLIENT_ID prefix: (first 20 chars of your client ID)
GOOGLE_CALLBACK_URL: https://your-backend.onrender.com/auth/google/callback
FRONTEND_BASE: https://your-frontend.vercel.app
server listening on port 5000
```

### 3. Test Vercel Frontend

1. Visit: `https://your-frontend.vercel.app`
2. Open browser console (F12)
3. Look for:
   ```
   API_BASE in browser: https://your-backend.onrender.com
   LoginPage API_BASE: https://your-backend.onrender.com
   LoginPage LOGIN_URL: https://your-backend.onrender.com/auth/google
   ```

### 4. Test OAuth Flow

1. Click "Start Google login" on your Vercel app
2. Should redirect to Google login
3. After Google authentication:
   - Redirects to: `https://your-backend.onrender.com/auth/google/callback`
   - Then redirects back to: `https://your-frontend.vercel.app`
4. You should be logged in

---

## Common Issues & Fixes

### Issue: "Redirect URI mismatch" from Google

**Check:**
- Render has `GOOGLE_CALLBACK_URL=https://your-backend.onrender.com/auth/google/callback`
- Google Cloud Console has exact same URI in authorized redirect URIs

### Issue: Vercel shows "undefined/auth/google"

**Fix:**
1. Verify `REACT_APP_API_URL` is set in Vercel environment variables
2. Trigger a new deployment after adding the variable
3. Check browser console for the correct API_BASE URL

### Issue: Variable name typo

**Watch out for:**
- ‚ùå `Google_client_id` (wrong - mixed case)
- ‚úÖ `GOOGLE_CLIENT_ID` (correct - all uppercase)

All environment variables in `server.js` expect UPPERCASE names.

### Issue: Login works but session doesn't persist

**Check Render has:**
- `NODE_ENV=production` (not `development`)
- This enables secure cookies for HTTPS

### Issue: CORS errors

**Verify on Render:**
- `FRONTEND_BASE=https://your-frontend.vercel.app` (exact match, no trailing slash)

---

## Deployment Checklist

Before going live, verify:

### Render (Backend):
- [ ] All environment variables set with correct UPPERCASE names
- [ ] `NODE_ENV=production`
- [ ] Service is deployed and running
- [ ] `/health` endpoint returns `{"status":"ok"}`
- [ ] Logs show all env vars are loaded correctly

### Vercel (Frontend):
- [ ] `REACT_APP_API_URL` environment variable is set
- [ ] Points to `https://your-backend.onrender.com`
- [ ] Redeployed after adding environment variable
- [ ] Browser console shows correct API_BASE URL

### Google Cloud Console:
- [ ] Redirect URI includes `https://your-backend.onrender.com/auth/google/callback`
- [ ] OAuth consent screen is configured
- [ ] Credentials are active (not revoked)

---

## Quick Reference

**Render Backend URL:** `https://your-backend.onrender.com`
**Vercel Frontend URL:** `https://your-frontend.vercel.app`
**OAuth Callback:** `https://your-backend.onrender.com/auth/google/callback`

**Critical Environment Variables:**
- Render: 9 variables (see above)
- Vercel: 1 variable (`REACT_APP_API_URL`)

---

## After Setup

Once you've configured everything, you can delete this file and keep your actual `PRODUCTION_CONFIG.md` (which is git-ignored) for local reference.
